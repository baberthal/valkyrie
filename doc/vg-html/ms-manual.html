<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>6. Massif: a heap profiler</title>
<link rel="stylesheet" href="vg_basic.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.64.1">
<link rel="home" href="index.html" title="Valgrind Documentation">
<link rel="up" href="manual.html" title="Valgrind User Manual">
<link rel="previous" href="cg-manual.annopts.html" title="5.3. cg_annotate options">
<link rel="next" href="ms-manual.using.html" title="6.2. Using Massif">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div><table class="nav" width="100%" cellspacing="3" cellpadding="3" border="0" summary="Navigation header"><tr>
<td width="22px" align="center" valign="middle"><a accesskey="p" href="cg-manual.annopts.html"><img src="images/prev.png" width="18" height="21" border="0" alt="Prev"></a></td>
<td width="25px" align="center" valign="middle"><a accesskey="u" href="manual.html"><img src="images/up.png" width="21" height="18" border="0" alt="Up"></a></td>
<td width="31px" align="center" valign="middle"><a accesskey="h" href="index.html"><img src="images/home.png" width="27" height="20" border="0" alt="Up"></a></td>
<th align="center" valign="middle">Valgrind User Manual</th>
<td width="22px" align="center" valign="middle"><a accesskey="n" href="ms-manual.using.html"><img src="images/next.png" width="18" height="21" border="0" alt="Next"></a></td>
</tr></table></div>
<div class="chapter" lang="en">
<div class="titlepage">
<div><div><h2 class="title">
<a name="ms-manual"></a>6. Massif: a heap profiler</h2></div></div>
<div></div>
</div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="ms-manual.html#ms-manual.spaceprof">6.1. Heap profiling</a></span></dt>
<dd><dl><dt><span class="sect2"><a href="ms-manual.html#ms-manual.heapprof">6.1.1. Why Use a Heap Profiler?</a></span></dt></dl></dd>
<dt><span class="sect1"><a href="ms-manual.using.html">6.2. Using Massif</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="ms-manual.using.html#ms-manual.overview">6.2.1. Overview</a></span></dt>
<dt><span class="sect2"><a href="ms-manual.using.html#ms-manual.basicresults">6.2.2. Basic Results of Profiling</a></span></dt>
<dt><span class="sect2"><a href="ms-manual.using.html#ms-manual.graphs">6.2.3. Spacetime Graphs</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="ms-manual.heapdetails.html">6.3. Details of Heap Allocations</a></span></dt>
<dd><dl><dt><span class="sect2"><a href="ms-manual.heapdetails.html#ms-manual.accuracy">6.3.1. Accuracy</a></span></dt></dl></dd>
<dt><span class="sect1"><a href="ms-manual.options.html">6.4. Massif options</a></span></dt>
</dl>
</div>
<p>To use this tool, you must specify
<tt class="computeroutput">--tool=massif</tt> on the Valgrind
command line.</p>
<div class="sect1" lang="en">
<div class="titlepage">
<div><div><h2 class="title" style="clear: both">
<a name="ms-manual.spaceprof"></a>6.1. Heap profiling</h2></div></div>
<div></div>
</div>
<p>Massif is a heap profiler, i.e. it measures how much heap
memory programs use.  In particular, it can give you information
about:</p>
<div class="itemizedlist"><ul type="disc">
<li><p>Heap blocks;</p></li>
<li><p>Heap administration blocks;</p></li>
<li><p>Stack sizes.</p></li>
</ul></div>
<p>Heap profiling is useful to help you reduce the amount of
memory your program uses.  On modern machines with virtual
memory, this provides the following benefits:</p>
<div class="itemizedlist"><ul type="disc">
<li><p>It can speed up your program -- a smaller
    program will interact better with your machine's caches,
    avoid paging, and so on.</p></li>
<li><p>If your program uses lots of memory, it will
    reduce the chance that it exhausts your machine's swap
    space.</p></li>
</ul></div>
<p>Also, there are certain space leaks that aren't detected by
traditional leak-checkers, such as Memcheck's.  That's because
the memory isn't ever actually lost -- a pointer remains to it --
but it's not in use.  Programs that have leaks like this can
unnecessarily increase the amount of memory they are using over
time.</p>
<div class="sect2" lang="en">
<div class="titlepage">
<div><div><h3 class="title">
<a name="ms-manual.heapprof"></a>6.1.1. Why Use a Heap Profiler?</h3></div></div>
<div></div>
</div>
<p>Everybody knows how useful time profilers are for speeding
up programs.  They are particularly useful because people are
notoriously bad at predicting where are the bottlenecks in their
programs.</p>
<p>But the story is different for heap profilers.  Some
programming languages, particularly lazy functional languages
like <a href="http://www.haskell.org" target="_top">Haskell</a>, have
quite sophisticated heap profilers.  But there are few tools as
powerful for profiling C and C++ programs.</p>
<p>Why is this?  Maybe it's because C and C++ programmers must
think that they know where the memory is being allocated.  After
all, you can see all the calls to
<tt class="computeroutput">malloc()</tt> and
<tt class="computeroutput">new</tt> and
<tt class="computeroutput">new[]</tt>, right?  But, in a big
program, do you really know which heap allocations are being
executed, how many times, and how large each allocation is?  Can
you give even a vague estimate of the memory footprint for your
program?  Do you know this for all the libraries your program
uses?  What about administration bytes required by the heap
allocator to track heap blocks -- have you thought about them?
What about the stack?  If you are unsure about any of these
things, maybe you should think about heap profiling.</p>
<p>Massif can tell you these things.</p>
<p>Or maybe it's because it's relatively easy to add basic
heap profiling functionality into a program, to tell you how many
bytes you have allocated for certain objects, or similar.  But
this information might only be simple like total counts for the
whole program's execution.  What about space usage at different
points in the program's execution, for example?  And
reimplementing heap profiling code for each project is a
pain.</p>
<p>Massif can save you this effort.</p>
</div>
</div>
</div>
<div>
<br><table class="nav" width="100%" cellspacing="3" cellpadding="2" border="0" summary="Navigation footer">
<tr>
<td rowspan="2" width="40%" align="left">
<a accesskey="p" href="cg-manual.annopts.html">&lt;&lt; 5.3. cg_annotate options</a> </td>
<td width="20%" align="center"><a accesskey="u" href="manual.html">Up</a></td>
<td rowspan="2" width="40%" align="right"> <a accesskey="n" href="ms-manual.using.html">6.2. Using Massif &gt;&gt;</a>
</td>
</tr>
<tr><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td></tr>
</table>
</div>
</body>
</html>
